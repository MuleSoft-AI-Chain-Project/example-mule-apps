<?xml version='1.0' encoding='UTF-8'?>
<types:mule xmlns:types="http://www.mulesoft.org/schema/mule/types">
  <types:catalog>
    <types:type name="auto_4d40a097-fae1-4330-b0b1-17cef4781a7d_Output-Variables-contextPath" format="java">
      <types:shape format="raml" autogeneratedOrigin="4adb008b-48e3-4132-8e34-dc8e67f88f1d"><![CDATA[#%RAML 1.0 DataType
type: string]]></types:shape>
    </types:type>
    <types:type name="auto_4d40a097-fae1-4330-b0b1-17cef4781a7d_Output-Variables-storeName" format="java">
      <types:shape format="weave" example="weave/autogenerated/4d40a097-fae1-4330-b0b1-17cef4781a7d/Output-Variables-storeName.wev" autogeneratedOrigin="4adb008b-48e3-4132-8e34-dc8e67f88f1d"><![CDATA[%dw 2.0

type auto_4d40a097_fae1_4330_b0b1_17cef4781a7d_Output_Variables_storeName = Any

]]></types:shape>
    </types:type>
    <types:type name="payload" format="json">
      <types:shape format="weave" example="examples/ingestion-payload.json"><![CDATA[%dw 2.0

type payload = {|
  contextPath: String, 
  mediaCaption: String, 
  storeName: String, 
  text: String
|} {"example": "{\\\"contextPath\\\":\\\"\\\",\\\"mediaCaption\\\":\\\"\\\",\\\"storeName\\\":\\\"\\\",\\\"text\\\":\\\"\\\"}"}

]]></types:shape>
    </types:type>
    <types:type name="retrieval-payload" format="json">
      <types:shape format="weave" example="examples/retrieval-payload.json"><![CDATA[%dw 2.0

type retrieval_payload = {|
  contextPath: String, 
  question: String, 
  storeName: String, 
  minScore: String
|} {"example": "{\\\"contextPath\\\":\\\"\\\",\\\"question\\\":\\\"\\\",\\\"storeName\\\":\\\"\\\",\\\"minScore\\\":\\\"\\\"}"}

]]></types:shape>
    </types:type>
    <types:type name="imagesPayload" format="json">
      <types:shape format="weave" example="examples/imagesPayload.json"><![CDATA[%dw 2.0

type imagesPayload = {|
  minScore: Number {"typeId": "double"}, 
  question: String, 
  sources: Array<{|    score: Number {"typeId": "double"},     metadata: {|      ingestion_timestamp: String,       media_type: String,       mime_type: String,       file_type: String,       index: String,       source: String,       source_id: String,       ingestion_datetime: String    |},     embeddingId: String,     text: String  |}>, 
  response: String, 
  maxResults: Number {"typeId": "int"}, 
  storeName: String
|} {"example": "{\\\"minScore\\\":0.5,\\\"question\\\":\\\"red bicycle\\\",\\\"sources\\\":[{\\\"score\\\":0.5663544421580767,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735129693\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%28373%29.jpg\\\",\\\"source_id\\\":\\\"cbe80d2d-7dc4-4671-8da9-3693049e1dcd\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:32:09.693355Z\\\"},\\\"embeddingId\\\":\\\"e7bca80a-2f7d-47d5-9280-4d8638178fe6\\\",\\\"text\\\":\\\"Image of a bicycle\\\"},{\\\"score\\\":0.5578315461525782,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735241565\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%28780%29.jpg\\\",\\\"source_id\\\":\\\"1c1b04a1-7ac6-400d-be3e-690ea0c79b17\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:34:01.565287Z\\\"},\\\"embeddingId\\\":\\\"8de07125-c673-475d-8361-4eb7501e8424\\\",\\\"text\\\":\\\"Image of a bicycle\\\"},{\\\"score\\\":0.556821267713384,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735248367\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%28791%29.jpg\\\",\\\"source_id\\\":\\\"7199557c-58a1-4373-95cd-7fd5b0ddac7e\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:34:08.367251Z\\\"},\\\"embeddingId\\\":\\\"52cb5218-3a08-46f8-9423-7466294d1db5\\\",\\\"text\\\":\\\"Image of a bicycle\\\"},{\\\"score\\\":0.5552170889144268,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735102053\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%28173%29.jpg\\\",\\\"source_id\\\":\\\"e78836d0-3a10-4827-9b75-1fb11e1d08e8\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:31:42.050997Z\\\"},\\\"embeddingId\\\":\\\"0c1c18c7-c566-4d3f-913c-df572b74f509\\\",\\\"text\\\":\\\"Image of a bicycle\\\"},{\\\"score\\\":0.5510171048949424,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735112543\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%2826%29.jpg\\\",\\\"source_id\\\":\\\"f8906c82-9696-4a0c-bf45-f8937dbadb0e\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:31:52.543623Z\\\"},\\\"embeddingId\\\":\\\"fa8bc848-e079-40be-bf52-4646630765b3\\\",\\\"text\\\":\\\"Image of a bicycle\\\"}],\\\"response\\\":\\\"Image of a bicycle\\\\n\\\\nImage of a bicycle\\\\n\\\\nImage of a bicycle\\\\n\\\\nImage of a bicycle\\\\n\\\\nImage of a bicycle\\\",\\\"maxResults\\\":5,\\\"storeName\\\":\\\"image_store\\\"}"}

]]></types:shape>
    </types:type>
    <types:type name="imagesPayloadFinal" format="json">
      <types:shape format="weave" example="examples/imagesPayloadFinal.json"><![CDATA[%dw 2.0

type imagesPayloadFinal = {|
  minScore: Number {"typeId": "double"}, 
  question: String, 
  sources: Array<{|    score: Number {"typeId": "double"},     metadata: {|      ingestion_timestamp: String,       media_type: String,       mime_type: String,       file_type: String,       index: String,       source: String,       source_id: String,       ingestion_datetime: String    |},     embeddingId: String,     text: String,     base64Image: String  |}>, 
  response: String, 
  maxResults: Number {"typeId": "int"}, 
  storeName: String
|} {"example": "{\\\"minScore\\\":0.5,\\\"question\\\":\\\"red bicycle\\\",\\\"sources\\\":[{\\\"score\\\":0.5663544421580767,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735129693\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%28373%29.jpg\\\",\\\"source_id\\\":\\\"cbe80d2d-7dc4-4671-8da9-3693049e1dcd\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:32:09.693355Z\\\"},\\\"embeddingId\\\":\\\"e7bca80a-2f7d-47d5-9280-4d8638178fe6\\\",\\\"text\\\":\\\"Image of a bicycle\\\",\\\"base64Image\\\":\\\"something\\\"},{\\\"score\\\":0.5578315461525782,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735241565\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%28780%29.jpg\\\",\\\"source_id\\\":\\\"1c1b04a1-7ac6-400d-be3e-690ea0c79b17\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:34:01.565287Z\\\"},\\\"embeddingId\\\":\\\"8de07125-c673-475d-8361-4eb7501e8424\\\",\\\"text\\\":\\\"Image of a bicycle\\\"},{\\\"score\\\":0.556821267713384,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735248367\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%28791%29.jpg\\\",\\\"source_id\\\":\\\"7199557c-58a1-4373-95cd-7fd5b0ddac7e\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:34:08.367251Z\\\"},\\\"embeddingId\\\":\\\"52cb5218-3a08-46f8-9423-7466294d1db5\\\",\\\"text\\\":\\\"Image of a bicycle\\\"},{\\\"score\\\":0.5552170889144268,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735102053\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%28173%29.jpg\\\",\\\"source_id\\\":\\\"e78836d0-3a10-4827-9b75-1fb11e1d08e8\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:31:42.050997Z\\\"},\\\"embeddingId\\\":\\\"0c1c18c7-c566-4d3f-913c-df572b74f509\\\",\\\"text\\\":\\\"Image of a bicycle\\\"},{\\\"score\\\":0.5510171048949424,\\\"metadata\\\":{\\\"ingestion_timestamp\\\":\\\"1740735112543\\\",\\\"media_type\\\":\\\"image\\\",\\\"mime_type\\\":\\\"image\\/jpeg\\\",\\\"file_type\\\":\\\"jpeg\\\",\\\"index\\\":\\\"0\\\",\\\"source\\\":\\\"s3:\\/\\/s3-bucket-1736703787\\/images\\/bikes\\/Bike%20%2826%29.jpg\\\",\\\"source_id\\\":\\\"f8906c82-9696-4a0c-bf45-f8937dbadb0e\\\",\\\"ingestion_datetime\\\":\\\"2025-02-28T09:31:52.543623Z\\\"},\\\"embeddingId\\\":\\\"fa8bc848-e079-40be-bf52-4646630765b3\\\",\\\"text\\\":\\\"Image of a bicycle\\\"}],\\\"response\\\":\\\"Image of a bicycle\\\\n\\\\nImage of a bicycle\\\\n\\\\nImage of a bicycle\\\\n\\\\nImage of a bicycle\\\\n\\\\nImage of a bicycle\\\",\\\"maxResults\\\":5,\\\"storeName\\\":\\\"image_store\\\"}"}

]]></types:shape>
    </types:type>
  </types:catalog>
  <types:enrichment select="#4d40a097-fae1-4330-b0b1-17cef4781a7d">
    <types:processor-declaration>
      <types:input-event>
        <types:message>
          <types:payload type="payload"/>
        </types:message>
      </types:input-event>
    </types:processor-declaration>
  </types:enrichment>
  <types:enrichment select="#49746fbf-ea0d-44ad-82d9-cbba02c79786">
    <types:processor-declaration>
      <types:input-event>
        <types:message>
          <types:payload type="retrieval-payload"/>
        </types:message>
      </types:input-event>
    </types:processor-declaration>
  </types:enrichment>
  <types:enrichment select="#285854c3-969f-4279-ab9f-e71acd6b83aa">
    <types:processor-declaration>
      <types:input-event>
        <types:message>
          <types:payload type="imagesPayload"/>
        </types:message>
      </types:input-event>
      <types:output-event>
        <types:message>
          <types:payload type="imagesPayloadFinal"/>
        </types:message>
      </types:output-event>
    </types:processor-declaration>
  </types:enrichment>
</types:mule>